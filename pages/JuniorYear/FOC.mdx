# 微机代码

## 数组求和

```ts
DATA SEGMENT                ;定义数据段
  ARRAY DW  -1700,7050,92
        DW  580,-630,-4450
  LEN   EQU ($-ARRAY)/2     ;LEN变量名
  RESL  DW  ?
  RESH  DW  ?               ;（?）通常用作占位符或未知值的标记
DATA ENDS

CODE SEGMENT                    ;定义代码段（code segment）
        ASSUME CS:CODE,DS:DATA  ;ASSUME 建立段寄存器与段名之间的关系
  START:MOV    AX,DATA
        MOV    DS,AX            ;立即数（Immediate value）直接作为操作数传递给寄存器是不允许的,要通过通用寄存器
        MOV    SI,0
        MOV    DI,0
        LEA    BX,ARRAY         ;LEA 是 "Load Effective Address" 的缩写，它执行的是地址计算的操作
        MOV    CX,LEN
        
  GOON: MOV    AX,[BX]
        CWD                     ;16位有符号数扩为32位有符号数
        ADD    SI,AX            ;不进位加
        ADC    DI,DX            ;ADC:带进位的加法操作
        ADD    BX, 2            ;每次+2
        LOOP   GOON
        MOV    RESL,SI
        MOV    RESH,DI
        MOV    AH,4CH
        INT    21H              ;程序会正常退出并返回到操作系统
CODE ENDS
END START ;标记程序的结束点



Q:'ADC    DI,DX ' 是什么
A:`ADC DI, DX` 是一条x86汇编指令，用于将 `DI` 寄存器的值与 `DX` 寄存器的值相加，并将结果存储回 `DI` 寄存器中，考虑进位标志位的值。
具体执行过程如下：
1. 将 `DI` 寄存器的值与 `DX` 寄存器的值相加，得到一个结果。
2. 如果进位标志位（Carry Flag）为1，表示有进位，那么结果会再加上进位标志位的值。
3. 最终的结果会存储回 `DI` 寄存器中。
需要注意的是，进位标志位可以通过之前的算术操作的结果来设置，或者可以手动设置或清除。通过 `ADC` 指令执行的加法操作会考虑到进位标志位的值，以便实现带进位的加法运算。
在给定的代码中，`ADC DI, DX` 执行的是将 `DI` 寄存器与 `DX` 寄存器的值相加，并将结果存储回 `DI` 寄存器中，同时考虑进位标志位的值。  
```

Q:执行到 INT 21H 指令时，控制权会转移到DOS操作系统，然后DOS操作系统会根据 AH 寄存器中的值来执行相应的功能。在这里,AH的值为4Ch，表示程序的正常退出请求。
	A:这个步骤是为了与操作系统进行交互并告知操作系统程序的退出请求。在早期的DOS操作系统中，提供了一组功能服务，可以通过中断调用来请求这些功能。INT 21H是DOS提供的一个中断号，通过触发此中断，程序可以与DOS操作系统进行交互并请求特定的功能。

在中断调用时，程序将设置寄存器的特定值，以指示所需的功能或操作。其中，AH寄存器通常用于指定所需功能的功能码。通过将4Ch值移动到AH寄存器，程序告知DOS操作系统它要请求的功能是程序的正常退出。

当程序执行INT 21H指令时，控制权会转移到DOS操作系统，DOS操作系统会根据AH寄存器中的值来确定所需的功能，并执行相应的操作。在这种情况下，DOS操作系统将接收到程序的正常退出请求，并相应地终止程序的执行。

这个步骤的目的是通过与操作系统进行交互，使程序能够向操作系统发送退出请求，以便程序可以正常地终止执行并返回到操作系统环境。

## 数组求偶数个数

```js
;统计偶数
DATA SEGMENT
  ARRAY DB  -18,47,-72,55,9
        DB  83,-21,-15,14
  COUNT EQU ($-ARRAY)
  RES   DW  ?
DATA ENDS
CODE SEGMENT
        ASSUME CS:CODE,DS:DATA
  START:MOV    AX,DATA
        MOV    DS,AX
        LEA    BX,ARRAY
        MOV    CX,COUNT
        MOV    DX,0
  GOON: MOV    AL,[BX]
        TEST   AL,1
        JNE    SKIP
        ADD    DX,1
  SKIP: INC    BX
        LOOP   GOON 
        MOV RES,DX 
        MOV AH,4CH 
        INT 21H
CODE ENDS
END START
```

